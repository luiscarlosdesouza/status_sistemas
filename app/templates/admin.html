{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Gerenciar Sites Monitorados</h2>
    <a href="/reports" class="btn btn-outline-dark">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-file-earmark-text me-2" viewBox="0 0 16 16">
            <path
                d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z" />
            <path
                d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z" />
        </svg>
        Ver Relatório de Falhas
    </a>
    <a href="/settings" class="btn btn-outline-secondary ms-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear-fill me-2"
            viewBox="0 0 16 16">
            <path
                d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z" />
        </svg>
        Configurações
    </a>
    <a href="{{ url_for('users') }}" class="btn btn-outline-primary ms-2">
        <i class="bi bi-people-fill"></i> Usuários
    </a>
</div>

<!-- Add Site Form -->
<div class="card mb-4">
    <div class="card-header bg-success text-white">
        <i class="bi bi-plus-circle"></i> Adicionar Novo Site
    </div>
    <div class="card-body">
        <form action="{{ url_for('admin.add_site') }}" method="POST" class="row g-3">
            <div class="col-md-4">
                <label for="name" class="form-label">Nome do Site</label>
                <input type="text" class="form-control" name="name" placeholder="Ex: Portal USP" required>
            </div>
            <div class="col-md-5">
                <label for="url" class="form-label">URL Completa</label>
                <input type="url" class="form-control" name="url" placeholder="https://..." required>
            </div>
            <div class="col-md-3">
                <label for="expected_text" class="form-label">Texto Esperado (Opcional)</label>
                <input type="text" class="form-control" name="expected_text" placeholder="Ex: Bem-vindo">
                <div class="form-text">Valida se o site carregou corretamente.</div>
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-success">Adicionar Monitoramento</button>
            </div>
        </form>
    </div>
</div>

<!-- Sites List -->
<div class="card shadow-sm">
    <div class="card-header">
        <i class="bi bi-list-check"></i> Sites Monitorados
    </div>
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>Nome</th>
                    <th>URL</th>
                    <th>Status Atual</th>
                    <th>Última Verificação</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for site in sites %}
                <tr>
                    <td>{{ site.name }}</td>
                    <td><a href="{{ site.url }}" target="_blank" class="text-decoration-none">{{ site.url }}</a></td>
                    <td>
                        {% if site.status == 'online' %}
                        <span class="badge bg-success">Online</span>
                        {% elif site.status == 'warning' %}
                        <span class="badge bg-warning text-dark">Atenção</span>
                        {% else %}
                        <span class="badge bg-danger">Offline</span>
                        {% endif %}
                    </td>
                    <td>{{ site.last_checked.strftime('%d/%m %H:%M:%S') if site.last_checked else 'Nunca' }}</td>
                    <td>
                        <a href="{{ url_for('admin.edit_site', id=site.id) }}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <form action="{{ url_for('admin.delete_site', id=site.id) }}" method="POST" class="d-inline"
                            onsubmit="return confirm('Tem certeza?');">
                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}